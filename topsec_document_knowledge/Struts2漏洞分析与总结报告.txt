Struts2历史重大漏洞分析与总结报告  
天融信阿尔法实验室  

Struts2历史重大漏洞分析与总结报告  
目录  
一 前言  
二 Struts2背景介绍  
2.1 Struts2框架背景  
2.2 Struts2漏洞简述  
2.3 Struts2影响概述  
2.4 Struts2修复情况  
三 Struts2漏洞统计及分析  
3.1 Struts2历史全版本漏洞简介  
3.2 Struts2重大漏洞分析  
3.2.1 S2-032  
漏洞描述  
受影响的系统版本  
漏洞编号  
漏洞分析  
3.2.2 S2-037  
漏洞描述  
受影响的系统版本  
漏洞编号  
漏洞分析  
3.2.3 S2-048  
漏洞描述  
受影响的系统版本  
漏洞编号  
漏洞分析  
3.2.4 S2-052  
漏洞描述  
受影响的系统版本  
漏洞编号  
漏洞分析  
3.2.5 S2-057  
漏洞描述  
受影响的系统版本  
漏洞编号  
漏洞分析  
四 Struts2漏洞数据分析  
4.1 Struts2漏洞历史时间统计  
4.2 Struts2漏洞类型统计  
4.3 Struts2行业分布态势  
4.4 Struts2全国分布态势  
4.5 Struts2运营商分布态势  
4.6 端口开放情况统计  
4.7 行业应对漏洞积极性  
4.8 Struts2漏洞真实案例  
五 总结及建议  
5.1 总结  
5.1.1 漏洞危害情况总结  
5.1.2 数据分析总结  
5.1.3 行业地区影响总结  
5.2 建议  

一 前言  
2018年，像往年一样，爆发了许多重大漏洞，例如Drupal远程代码执行漏洞、S2-057命令执行、Adobe Flash Player任意代码执行等，其中包括了长期存在的Struts2 RCE漏洞。  
Struts2作为全球最流行的Java Web服务器框架之一，被广泛应用于金融、教育、医疗等多个行业，其漏洞的危害极大。为了提高大家对Struts2漏洞的认知和重视，天融信阿尔法实验室编制了本报告，从Struts2的背景介绍、漏洞统计、漏洞数据及漏洞建议等方面进行了全面阐述。  

二 Struts2背景介绍  
2.1 Struts2框架背景  
Struts是Apache基金会Jakarta项目组的一个开源项目，采用MVC模式，极大地方便了Java开发者利用J2EE开发Web应用。Struts1因其与JSP/Servlet的紧密耦合而存在一些问题，限制了其发展。随着技术进步，许多新的视图层框架出现，Struts1逐渐被Struts2所取代。  
Struts2作为Struts的下一代产品，注入了WebWork的先进设计理念，统一了Struts1和WebWork两个框架，成为一个简洁、可扩展的基于MVC设计模式的框架，用于创建企业级Java Web应用程序。  

2.2 Struts2漏洞简述  
自编号S2-001的Struts2命令执行漏洞被发现以来，漏洞数量已上升至57个，横跨十余年，涵盖多种类型的漏洞，包括命令执行、XSS、目录遍历和安全bypass等。命令执行类漏洞尤为严重，攻击者可以利用这些漏洞通过恶意OGNL表达式执行任意代码。  

2.3 Struts2影响概述  
由于Struts2框架的广泛应用，漏洞一经爆发，影响范围十分广泛，涉及教育、政府、金融、互联网等多个行业。尤其是在北京、上海、广州等经济发达地区，成为漏洞高发区。  
Struts2框架的漏洞在高校网络中尤为突出，许多信息系统在开发阶段使用了Struts2，后期运营人员往往对底层架构不熟悉，导致漏洞长期存在，造成严重的安全隐患。  

2.4 Struts2修复情况  
目前，各大安全厂商和组织已将这些漏洞视为高危漏洞进行处理，一旦发现，便会迅速进行分析和预警，并提供解决方案。针对近期出现的编号S2-057漏洞，天融信阿尔法实验室及时提供了详细信息和解决方案，企业和个人可根据自身安全策略迅速修复。  

三 Struts2漏洞统计及分析  
3.1 Struts2历史全版本漏洞简介  
自2007年第一个Struts2漏洞S2-001至今，漏洞数量已达57个，涵盖RCE、XSS、CSRF、DOS等多种类型，其中命令执行类漏洞多达17个。  
虽然并非所有漏洞都受到关注，但一些危害不大的漏洞仍然被忽视，而一些在当年引起广泛关注的漏洞则如S2-003、S2-005等，至今仍需重视。  

3.2 Struts2重大漏洞分析  
3.2.1 S2-032  
漏洞描述  
当启用动态方法调用时，攻击者可构造恶意表达式，在服务器端执行任意代码，获得服务器权限。  
受影响的系统版本  
Struts 2.3.20 - Struts 2.3.28（2.3.20.3和2.3.24.3除外）  
漏洞编号  
CVE-2016-3081  
漏洞分析  
该漏洞存在于Struts2的动态方法引用功能中，只要在配置文件中开启该功能，就可能被利用。  

3.2.2 S2-037  
漏洞描述  
该漏洞因对method没有进行过滤，使用REST插件的Struts2应用可能遭受远程代码执行攻击。  
受影响的系统版本  
Struts 2.3.20 – Struts 2.3.28.1  
漏洞编号  
CVE-2016-4438  
漏洞分析  
本漏洞是基于S2-032的一个绕过，不需要开启动态方法执行即可触发代码执行漏洞。  

3.2.3 S2-048  
漏洞描述  
在Struts 2.3.X系列的Showcase插件中，存在任意代码执行漏洞。当Web应用使用了Struts 2 Struts 1插件时，可能导致Struts2执行外部输入的恶意代码。  
受影响的系统版本  
Struts 2.3.x系列中启用了struts2-struts1-plugin插件的版本。  
漏洞编号  
CVE-2017-9791  
漏洞分析  
漏洞存在于org.apache.struts2.s1.Struts1Action类的execute方法中。  

3.2.4 S2-052  
漏洞描述  
Struts2 REST插件的XStream组件存在反序列化漏洞，攻击者可通过此漏洞进行远程攻击。  
受影响的系统版本  
Struts 2.5 – Struts 2.5.12  
漏洞编号  
CVE-2017-9805  
漏洞分析  
数据内容未经过有效验证，存在安全隐患。  

3.2.5 S2-057  
漏洞描述  
当struts.mapper.alwaysSelectFullNamespace设置为true且namespace值缺失或使用通配符时，可能导致namespace被控制，从而产生远程代码执行漏洞。  
受影响的系统版本  
Struts 2.3 - Struts 2.3.34  
Struts 2.5 - Struts 2.5.16  
漏洞编号  
CVE-2018-11776  
漏洞分析  
当alwaysSelectFullNamespace为true时，namespace的值可从URL获取，导致远程代码执行漏洞。  

四 Struts2漏洞数据分析  
4.1 Struts2漏洞历史时间统计  
自2007年发布以来，Struts2的漏洞数量每年递增，到2016年达到18个的峰值。2017年数量稍有下降，但仍保持在双位数水平。  

4.2 Struts2漏洞类型统计  
在过去10年中，共爆发57个Struts2漏洞，其中命令执行类漏洞占49%，共计28个。  

4.3 Struts2行业分布态势  
在监测网站中，教育行业占比最高（25%），其次是政府（21%）、金融（15%）、企业（11%）、能源（9%）等行业。  

4.4 Struts2全国分布态势  
在使用Struts2的8万网站中，北京市的数量最多，占21%；广东省和浙江省分别占17%和14%。  

4.5 Struts2运营商分布态势  
运营商分布情况中，电信、阿里云、联通排名前三，符合我国互联网运营商基础设施的分布情况。  

4.6 端口开放情况统计  
Struts2的服务器主要开放80、443、8080等常用端口。  

4.7 行业应对漏洞积极性  
金融、政府、教育行业在应对漏洞方面积极性较高，尤其是金融行业，反应迅速。  

4.8 Struts2漏洞真实案例  
2014年，某安全测试工程师利用Apache基金会公布的漏洞入侵某邮箱服务器，导致数据泄露。2016年，某知名电商因Struts2安全漏洞导致12G用户数据泄露，涉及多项敏感信息。  

五 总结及建议  
5.1 总结  
Struts2漏洞大致可分为DOS、XSS、安全bypass、命令执行、目录遍历等类型，其中命令执行类漏洞危害最大。  
自2007年以来，Struts2漏洞频繁爆发，原因在于常用黑名单修复方式导致漏洞层出不穷。  

5.1.2 数据分析总结  
截至目前，57个Struts2漏洞中，命令执行类漏洞约占三分之一，主要集中在2012年至2017年期间。  

5.1.3 行业地区影响总结  
根据行业分布，教育行业受影响最大，其次是政府和金融行业。  

5.2 建议  
使用Struts2的企业应关注官方公告及安全厂商的预警分析，及时修复已知漏洞。建议定期进行安全检查和升级，以降低风险。