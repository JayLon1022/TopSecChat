ChernoLocker 勒索病毒样本分析

病毒概述  
近日，天融信EDR安全团队捕获到一例病毒样本。黑客通过社交工程手段诱骗受害者点击下载文件，点击后，病毒伪装成.NET Framework的错误信息，开始进行加密。它使用空格填充文件内容，使其对齐为16的倍数，并采用AES算法加密文件内容，最后弹出勒索信息。天融信EDR能够精确检测并清除该木马，有效阻止事件的蔓延。

病毒分析  
收到样本后，使用侦壳软件打开，发现没有壳体。查看文件的熵值，判断可能存在加密数据。经过分析，怀疑该病毒可能调用了python27.dll，推测其可能为一个Python打包程序。

将exe解压为pyc文件，并将pyc文件转换为py文件，读取病毒代码进行分析，了解病毒整体的工作流程，病毒会显示.NET Framework的错误信息。

病毒的加密流程  
病毒首先使用Fernet加密技术进行混淆，首先加密PPT等文档类文件。它获取系统盘符，遍历系统盘符，开始加密文件。病毒将字符串转换为SHA256作为秘钥，并开始对文件进行加密。加密完成后，病毒调用加密函数，进而加密视频类文件。它会获取系统盘符，遍历加密，如果遇到FLV等类型的文件，便开始加密。遍历读取文件，将文件的绝对路径拼接成功后，开始加密文件，完成后释放勒索信息。

具体加密文件步骤  
病毒使用AES算法进行加密，完成后释放勒索信息。它联网下载图片，地址为：hxxps://platinumdatasolutionsltd.co.ke/wp-content/uploads/2018/11/landing-screenshot-img-9-768.jpg，并获取桌面路径，将图片下载到桌面，保存为landing-screenshot-img-9-768.jpg。

防护建议  
针对该病毒，可以通过以下三种方式进行防御或查杀：  
1. 下载安装天融信EDR防御软件并进行全盘扫描查杀，以清除该木马。  
2. 更改系统及应用的默认密码，配置高强度密码认证，并定期更新密码。  
3. 及时修复系统及应用的漏洞。

天融信EDR获取方式  
- 天融信EDR企业版试用：可通过天融信各地分公司获取（查询网址：http://www.topsec.com.cn/contact/）  
- 天融信EDR单机版下载地址：http://edr.topsec.com.cn