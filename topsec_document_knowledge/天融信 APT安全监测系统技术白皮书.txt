天融信 APT安全监测系统技术白皮书

版权声明
本文档中的所有内容及格式的版权属于北京天融信科技有限公司（以下简称天融信）所有，未经天融信许可，任何人不得仿制、拷贝、翻译或任意引用。版权所有，禁止翻印 ©2024天融信公司

商标声明
本文档中提及的产品名称仅用于识别。文档中涉及的其他公司的注册商标或版权均属各商标注册人所有，恕不逐一列明。

信息反馈
http://www.topsec.com.cn

目录
1 前言
2 产品概述
2.1 产品简介
2.2 流量安全检测
2.3 嵌入式威胁情报
2.4 未知恶意程序检测
2.5 多维知识库支撑
2.6 全流量元数据挖掘
2.7 AI融入安全
3 产品核心功能
3.1 攻击检测
3.2 账号安全检测
3.2.1 弱口令
3.2.2 暴力破解
3.3 僵木蠕检测
3.4 DDoS检测
3.5 恶意程序检测
3.6 APT检测
3.7 WEB安全检测
3.8 虚拟沙箱
3.9 威胁情报
3.10 异常流量检测
3.10.1 非法外联检测
3.10.2 DGA域名检测
3.10.3 隐蔽隧道检测
3.11 加密流量检测
3.12 溯源取证
3.13 URL检测
3.14 威胁处置
3.15 元数据提取
3.16 流量分析
3.17 资产识别
3.18 日志报表
3.19 可视化管理
4 部署方案
4.1 单机部署
4.2 平台部署
5 产品规格

1 前言
互联网和移动互联网的快速发展推动了传统行业的转型，促进了生产力的增长，同时也催生了许多新兴行业，极大提升了我国经济发展。网络和信息化产业在我国的重要性不断上升，网络安全问题也日益凸显。习近平总书记在中央网络安全和信息化领导小组第一次会议上指出，“没有网络安全，就没有国家安全”，将网络安全提升至国家主权的高度。

尽管近年来，政府、学校、能源、金融、医疗等各行各业都加大了对网络安全的投资和教育普及，但总体来看，我国的网络安全保障仍无法应对当前网络空间的快速发展。我国作为经济大国和网络强国，一直被黑客组织视为重要目标。当前网络安全面临以下现状：

1. 恶意程序依然是主要的网络威胁之一。国家计算机网络应急技术处理协调中心发布的《我国互联网网络安全态势》显示，CNCERT新增捕获的计算机恶意程序样本数量达到4298万个，恶意程序传播次数日均约998万次。尽管数量保持稳定，但恶意程序在我国的安全威胁依然占据主要地位。

2. 僵尸网络遍布。恶意程序的频繁传播导致感染恶意程序的计算机数量居高不下。根据CNCERT的抽样监测，我国境内感染恶意程序的计算机数量约240万台，境外的约3.9万个恶意程序控制服务器控制了我国境内约210万台主机。抽样检测数据显示，规模在10万台以上的僵尸网络数量达21个。

3. 新型威胁层出不穷。从勒索病毒、恶意代码程序、APT攻击到未知攻击的迅速增长，网络安全现状表明入侵攻击不断升级，新型威胁不断涌现。传统流量监测产品采用特征匹配和行为分析的方式，仅在监测到已发生攻击的特征和行为时采取响应措施，这种被动防御的方式已无法应对当前新型网络威胁。

4. 国产化需求日益增加。各级党政军机关和企事业单位的系统环境中承载了越来越多的重要业务与数据，这些信息关乎社会经济稳定发展，甚至涉及国家机密。如果关键基础设施和设备受到外部控制，网络安全和信息保密措施不力，将危及国家的安全、稳定和利益。因此，国产化安全的建设任重而道远，必须从根本上保障国家信息安全，实现真正的自主可控。

国产化探针设备作为网络边界安全的基础设施，必须能够全面、精准地检测已知和未知威胁。在被动防御的同时，也应主动感知网络中的威胁，提前做好防御。许多企业在网络安全建设中，会在边界部署多款威胁检测设备，但这些设备的功能往往部分重叠，导致采购成本增加和管理工作繁琐。因此，当前的网络边界安全产品应朝着高效、集合多功能和便于管理的方向发展。 

2 产品概述
2.1 产品简介
天融信APT安全监测系统（以下简称TopAPT）是由天融信自主研发的全流量威胁检测产品。该产品集成攻击检测、僵木蠕检测、DDoS检测、恶意程序检测、APT检测、WEB安全检测、虚拟沙箱、元数据提取和流量分析等九大功能，通过深度解析网络流量，结合特征匹配、异常行为分析、威胁情报、机器学习和虚拟沙箱等技术，实现对网络中各种已知和未知威胁的快速、精准识别。TopAPT全面的威胁监测能力让网络安全状态一目了然，提升风险应对能力。

TopAPT可采用设备与管理一体化模式，直接在检测设备上集成管理系统，也可进行分布式部署，通过集中管理平台进行统一管理。

2.2 流量安全检测
TopAPT集成了攻击检测、僵木蠕检测、DDoS检测、恶意程序检测、APT检测、WEB安全检测、虚拟沙箱、元数据提取和流量分析等九大功能，能够实现对网络威胁的全面检测。在多需求的探针应用场景中，无需部署其他设备，TopAPT单款设备即可实现多种检测效果，从而节省安全建设成本，减少运维管理工作量。

2.3 嵌入式威胁情报
TopAPT采用本地嵌入威胁情报库的方式，无需与第三方威胁情报平台联动即可独立实现威胁情报能力。TopAPT的威胁情报库由天融信安全云服务产品线分析产出，包含恶意IP、恶意URL、恶意域名、恶意文件等多种情报类型，具备800多万条高可靠的威胁情报数据，情报来源可靠、类型丰富、更新迅速、独立性强。

2.4 未知恶意程序检测
TopAPT首创应用智慧引擎，结合虚拟沙箱的检测技术，在不依赖任何规则库的情况下，实现高效、精准的恶意程序检测能力。智慧引擎通过海量样本训练的机器学习模型识别恶意程序。虚拟沙箱检测采用仿真技术，模拟操作系统环境，构建执行引擎，动态化分析发现恶意程序。智慧引擎与虚拟沙箱的结合，打破了传统特征匹配技术的束缚，既能检测已知恶意程序，也能检测未知恶意程序，是发现未知威胁、尤其是APT攻击的有力工具。

2.5 多维知识库支撑
TopAPT拥有攻击检测规则库、应用识别库、地理信息库、僵尸主机规则库、威胁情报库和URL分类库六大知识库。其中，攻击规则库数量超过13000条，威胁情报库数量超过800万条，URL分类库数量超过1000万条。多维、丰富的知识库使产品在威胁检测、攻击定位、上网行为分析等方面更加精确、迅速，知识库由天融信专业团队支持，确保高频更新。

2.6 全流量元数据挖掘
TopAPT具备全流量元数据深度挖掘能力，以流量元数据为基础，实现对攻击事件信息、僵尸主机行为信息、恶意软件信息、恶意域名/URL访问信息和DDoS攻击等多种安全事件的信息记录，支持对安全事件进行攻击报文和恶意样本文件取证，并详细记录多种网络通信的元数据信息。TopAPT可对所有的安全事件信息、取证信息和元数据信息进行加密输出，为态势感知等第三方平台提供丰富的数据。

2.7 AI融入安全
天融信专注于AI技术在安全检测中的实践与应用，利用多年累积的海量文件和流量样本，将数据构建成特征矩阵并训练AI模型，研发了TAI系列智慧引擎，广泛应用于天融信多款检测和防护产品中，通过智慧引擎整体提升检测效果，既能检测各种传统攻击行为，也能够检测已知威胁，提高整体的安全检测能力，大幅提升安全检测的效率和准确性。

3 产品核心功能
3.1 攻击检测
TopAPT的攻击检测集成了天融信IPS产品的专业检测引擎，采用协议分析，融合模式匹配、统计阀值和流量异常监视等综合技术手段，深入分析L2至L7层网络，精确检测网络中的入侵行为。能够检测以下多种攻击行为：
- 常见攻击行为：支持对扫描攻击、缓冲区溢出攻击、拒绝服务攻击、漏洞扫描攻击、蠕虫病毒攻击、非授权访问攻击、后门木马攻击、文件漏洞攻击等常见攻击行为的检测。
- 攻击逃逸的检测：具有防逃逸检测能力，能够从根源上检测逃逸行为攻击，支持对IP分片逃逸行为、TCP流重组逃逸行为、协议端口重定向逃逸行为、URL变形逃逸行为等多种逃逸行为的攻击识别。
- DNS投毒检测：具备DNS投毒检测能力。
- ARP攻击检测：支持从源目IP、MAC等维度分析ARP请求和响应的合法性。

3.2 账号安全检测
3.2.1 弱口令
近两年，随着企业数字化转型的推进，业务应用与互联网交互不断深入，大量重要数据与信息存储、流转于业务系统内，成为黑客觊觎的焦点。目前，因为弱口令问题造成的信息泄露和内网渗透等安全问题仍层出不穷。TopAPT的弱口令检测通过密码字典和口令强度双重模式实现对弱口令的攻击检测，设备检测到密码符合弱口令字典或者密码符合配置的密码强度时，会判断为弱口令。可支持对邮件协议、文件协议、远程连接协议、数据库协议和Web应用等多种协议的识别检测，有效应对弱口令攻击行为。

3.2.2 暴力破解
暴力破解主要指攻击者使用暴力破解工具，通过无限次尝试登录，最终获取到正确的登录口令。暴力破解成功后，攻击者通过非授权访问的途径获取合法用户的授权，窃取用户资源信息，造成严重损失。TopAPT会判断在配置的周期内登录失败的次数是否超过配置的检测次数，若登录失败次数超过阈值，则判断为暴力破解攻击行为。系统支持对邮件协议、文件协议、远程连接协议、数据库协议和Web应用等多种协议的识别检测，有效应对暴力破解攻击行为。

3.3 僵木蠕检测
被感染木马和蠕虫病毒的计算机会与外部黑客控制端进行C&C通信，接受黑客命令与控制，从而成为僵尸主机。TopAPT根据木马和蠕虫病毒的活跃周期，采用行为特征匹配、智慧引擎技术和异常行为分析等多种检测方式，有效帮助客户排查网络中的木马扩散、肉鸡、挖矿、勒索和被恶意监视等威胁。TopAPT通过对网络中协议异常、访问异常和连接异常的主机提取通信行为特征，采用木马特征库匹配的方式检测网络中木马和蠕虫的活动行为，从而识别定位网络中的僵尸主机。支持对僵尸网络行为、木马控制行为、蠕虫活动行为、勒索病毒行为和移动端木马控制行为等多种僵尸主机行为进行检测。对于被检测到的僵尸主机异常行为，TopAPT支持对异常行为报文取证和事件记录，事件记录包括攻击源信息、事件应用协议和事件描述等信息。

3.4 DDoS检测
TopAPT的DDoS攻击检测集成了天融信专业抗DDoS产品的检测引擎，支持对IP扫描攻击、端口扫描攻击等多种扫描类的DDoS攻击检测。支持对ICMPFLOOD、TCPFLOOD、UDPFLOOD、SYNACKFLOOD、FINFLOOD、RSTFLOOD、DNSFLOOD、HTTPFLOOD和HTTPSFLOOD等多种FLOOD攻击行为进行检测。TopAPT具有流量阈值自学习的能力，能够根据某一时间段内的流量状态，自动学习设置流量阈值，当流量状态异常时，触发阈值，系统自动进行告警。

3.5 恶意程序检测
TopAPT对网络中使用HTTP、FTP、SMTP、POP3、SMB、DNS、NFS、IMAP等非加密协议以及HTTPS、FTPS、SMTPS、IMAPS等加密协议传输的文件，采用特征检测、TAI智慧引擎、虚拟沙箱和第三方联动等多种技术手段检测是否存在恶意程序。TAI智慧引擎采用机器学习技术，以文件数据流中提取的PE头的二进制信息为源数据，通过海量样本训练的机器学习模型识别恶意程序。虚拟沙箱是模拟高仿真系统环境，对文件进行一系列的仿真执行指令，以发现文件的异常行为，从而验证恶意程序。特征检测则是通过文件MD5值，与恶意文件库进行匹配，精准验证已知恶意程序。

TopAPT支持对压缩类型、Windows可执行类、Linux可执行类型、移动端类、图片类和文档类病毒文件进行检测。同时，对被检测文件，系统可进行样本还原和留存，留存样本文件支持用户本地下载和加密外发。

3.6 APT检测
APT攻击是黑客组织对特定目标展开的持续有效攻击活动，具有极强的隐蔽性、针对性和持久性。TopAPT在APT检测上具有三种方式：
- 依靠威胁情报检测已知APT攻击行为。TopAPT的威胁情报库中具有多种APT威胁情报信息，包括APT攻击涉及的恶意IP、恶意域名、恶意URL和恶意文件等情报。通过对APT威胁情报的感知，可以在APT攻击的早期阶段提前防控风险。
- 依靠智慧引擎检测未知威胁。在APT攻击中，黑客组织通常将特制的恶意程序植入目标网络中，利用植入的恶意程序命令和控制目标网络，从而发动攻击行为。TopAPT具备精准的恶意程序检测能力，能够有效识别网络中传输的隐蔽性高的APT恶意文件。其特有的TAI智慧引擎与虚拟沙箱检测方式，可以检测未知恶意代码，进而发现未知APT事件。
- 依靠僵尸主机检测已知APT组织。APT组织在活动过程中具有特定的行为，TopAPT通过僵尸主机行为库检测异常主机行为的方式，识别网络中活跃的APT组织，并对APT攻击组织的异常行为进行监测。

3.7 WEB安全检测
WEB攻击主要针对用户上网行为或网站服务器等设备，利用安全漏洞植入恶意代码，篡改网站权限，获取用户隐私信息，可能导致系统网页被篡改、恶意弹窗、域名劫持等风险，因此确保WEB安全至关重要。TopAPT采用攻击特征匹配与智慧引擎的方式，实现WEB安全检测，支持对SQL注入攻击、跨站攻击、浏览器劫持攻击、URL跳转攻击、目录遍历攻击、WEB缓冲区溢出攻击、WEB漏洞攻击、WEB越权攻击、WEB远程代码执行攻击、WEB扫描攻击、Webshell上传攻击、文件上传、爬虫等多种类型的WEB攻击检测。

3.8 虚拟沙箱
虚拟沙箱采用仿真技术，模拟操作系统环境，构建执行引擎，实现在恶意代码检测中的应用。虚拟沙箱的基本要求包括：虚拟化执行效率高，具有完备的操作系统环境仿真，能够捕获记录程序虚拟执行时的行为。TopAPT的虚拟沙箱中具备文件系统、注册表系统、窗口系统等多种操作系统核心机制，达到高度仿真效果，且具备跨平台特性。执行引擎结合虚拟化执行引擎和动态翻译执行引擎，既能保证对文件的执行效率与真实机相当，又能实现对目标代码的细粒度控制。TopAPT的虚拟沙箱可实现对恶意代码进行通用脱壳、深度扫描和动态行为分析等深度检测。

- 通用脱壳：在不需要识别样本是否加壳的情况下，通过将样本放入虚拟沙箱深度执行并通过启发式逻辑分析样本数据是否已被还原。
- 深度扫描：跟踪其中进程释放的文件、创建的进程等，沙箱在扫描过程中会对这些衍生物进行扫描，实现对样本的深度扫描。
- 动态行为分析：支持跟踪和记录运行在沙箱中的程序行为，通过一系列分析算法对程序行为进行分析。TopAPT通过虚拟沙箱，实现对恶意代码威胁的动态检测，打破静态检测的壁垒。

3.9 威胁情报
威胁情报是将收集的原始数据和信息经过分析处理，提炼出与目标网络威胁相关的指标，用于发现当前网络面临的现有或潜在威胁及风险。不同于传统安全手段在安全事件发生时才采取防御响应，威胁情报的基本目标是早发现、早预防。TopAPT的威胁情报功能通过对网络数据流深入解析，解析出IP、URL、域名、文件MD5值等多种信息，并放入威胁情报库进行匹配，能够对恶意威胁样本进行还原捕获。相较于传统特征检测方式，威胁情报检测的范围更广，威胁情报库提取了800万条以上高可信威胁，检测威胁类型多维，检测速度快，且保持高频率更新，及时更新热点威胁情报信息。

3.10 异常流量检测
3.10.1 非法外联检测
该部分主要对服务器进行保护，依据管理员配置的合规行为，对服务器外联行为进行监控，检测服务器是否主动与外部进行通信（可能中毒）。针对异常通信行为，系统会发出告警并上报管理员进行进一步处理。

3.10.2 DGA域名检测
TopAPT可通过AI深度学习技术中的循环神经网络（RNN），对海量恶意域名样本充分训练生成检测模型，从而识别网络中的伪随机域名，解决DGA域名算法逆向破解的难题，实现对隐秘性高的DGA恶意域名的深入检测。RNN具备自动提取样本特征的能力，能够挖掘其内在的字符分布统计特征，大幅提升传统方法的分类精度，实现高检测率、低误报率和漏报率。

3.10.3 隐蔽隧道检测
TopAPT支持针对失陷主机异常外联通信行为进行非法外联监测，做到从内到外的威胁监测能力。对通信协议采用智能分析手段，能够有效识别僵尸主机使用“私有”协议建立的隐秘通信通道。同时，结合异常行为检测与智慧引擎检测等多种手段，实现对DNS隧道、ICMP隧道和HTTP隧道的异常通信监测，深入检测隐蔽隧道。

3.11 加密流量检测
在网络通信中，为确保传输内容的安全，通常会对通信流量进行加密处理。然而，流量加密也让恶意流量有机会隐藏并躲过检测。TopAPT通过导入证书与无证书检测相结合的方式，直接对加密流量进行解密处理，实现对加密流量元数据的深度提取，检测潜在的恶意威胁信息。设备通过智慧引擎检测、异常握手检测、非法证书检测和内网流量检测等多种方式发现恶意程序的加密通信。天融信安全研究团队对恶意程序行为进行深入分析，提取出恶意程序加密通信的指纹特征，生成指纹特征库。TopAPT的加密检测引擎对加密流量的报文进行深度解析，从中筛选出潜在的恶意加密流量，并通过将摘要与指纹特征库进行匹配，确认恶意程序的通信行为。

3.12 溯源取证
TopAPT支持对入侵攻击、僵尸网络和恶意程序等威胁事件进行取证记录，支持流量报文取证和样本文件取证。具备全流量取证能力，能够抓取和保存恶意事件的事前、事中及事后流量。系统将安全事件的元数据信息与取证文件关联，用户可通过威胁基本元数据的检索方式获取全面的威胁信息，便于深入溯源分析。此外，设备还具备攻击有效性研判能力，通过会话关联分析方式判断攻击的有效性，节省用户威胁溯源排查时间。

3.13 URL检测
在重视外部对内部网络发起的攻击威胁时，也应关注内网用户对钓鱼网站、挂马网站等恶意网站的访问，这也是网络威胁的一种来源，具有极大的安全隐患。TopAPT拥有上千万条URL分类库，地址库种类全面、详细，包括搜索引擎、社交网络、网上购物、求职招聘、休闲娱乐、财经、恶意网站、非法及不良网站、成人内容、网络安全及下载网站等，通过对网络中URL的识别，精准有效发现用户对非法网站的访问行为，有助于对威胁和恶意风险的控制。

同时，通过对网络中的URL实时监测，详细记录各主机对网站的访问行为，可以按网站、主机等维度进行统计，有效地帮助管理员分析用户的上网行为。

3.14 威胁处置
TopAPT在威胁检测的同时也具备威胁处置能力，支持对入侵攻击、僵木蠕行为、恶意程序传播、APT攻击、WEB攻击、访问非法URL/域名和恶意IP通信等安全事件进行阻断处置，支持旁路阻断处置、防火墙联动阻断处置和EDR联动阻断处置三种方式。通过阻断处置，使产品在进行威胁检测的同时，也具备威胁防御能力，更好地保障网络安全。

3.15 元数据提取
TopAPT具备对多种常见协议深入内容层解析的能力，实现对流量元数据的细粒度提取，帮助安全分析人员快速了解网络内容。支持对TCP/UDP流量、ICMP流量、HTTP流量、邮件流量、FTP流量、DNS流量、NFS流量、SMB流量、SSL流量、LDAP流量、RDP流量等多种非加密流量以及HTTPS流量、加密邮件流量、FTPS流量等多种加密流量进行深度提取元数据信息。提取的元数据，除了基本的五元组信息外，还包括多种类型的内容层信息，如邮件元数据、文件元数据和URL访问元数据等。支持对NDP3、MODBUS工控物联网协议提取元数据信息。

3.16 流量分析
TopAPT对所有网络数据流通过流量解析、协议还原和会话关联等方式实现全面的流量分析。支持对报文流入流出速率进行实时监控，每分钟对接收的报文按传输层协议、网络层协议和报文字节大小等多维度进行统计分析，同时记录各接口的流量趋势，按天、周、月进行图形化记录。TopAPT支持从应用维度详细分析所有网络流量，记录统计各应用的总流量、上下行流量、当前上下行速率和连接数等信息，同时记录应用的流量趋势图，并分析记录应用的主机访问详情，包括主机IP、总流量和连接数等信息。TopAPT支持对文件传输、P2P、即时通讯、工控物联网、加密隧道、数据库、移动应用等24大类超过5000种应用进行识别分析。

3.17 资产识别
TopAPT支持识别网络中的资产信息，具备资产识别能力，帮助用户全面掌握当前网络资产情况。主动识别是从镜像采集的网络流量中解析出存在的资产信息，识别效率高；被动扫描是对指定网络中存在的活跃资产信息进行全面深度扫描，扫描结果更加全面。资产信息记录包括资产IP、MAC、操作系统、资产类型、分组及应用服务列表等详细信息。

3.18 日志报表
TopAPT能够详实且细粒度记录安全事件日志、系统日志、元数据提取日志等多种类型的日志。不同日志类型按不同维度进行记录，用户可根据日志类型配置存储空间和日志级别，并支持对日志合并及加密外发。此外，TopAPT还具备强大的报表能力，能够按事件类型、主机和业务等维度对指定时间段的检测结果进行汇总统计，支持自定义模板内容，选择不同种类事件，定时发送报表，帮助管理员迅速了解当前网络安全状态。

3.19 可视化管理
TopAPT在集成多种功能的同时，秉承高效管理的设计理念，具备良好的可视化管理。产品在威胁检测、分析、处理和审查等管理上实现可视化和透明化，用户能够迅速了解安全事件的攻击源、受害主机、触发规则、响应动作和事件说明等信息。同时，通过大量事件数据的关联，能够从被攻击主机、攻击源主机和时间等多维度进行统计展示，帮助用户从宏观角度了解全网的安全态势。

4 部署方案
4.1 单机部署
TopAPT采用旁路镜像部署模式，设备部署在用户环境的网络出口或核心交换机等位置，在实现网络流量威胁检测的同时，完全不需要改变用户的网络环境，避免设备影响用户网络架构。

4.2 平台部署
根据用户的网络情况及项目需求，采用TopAPT探针与TopAPT管理平台产品组合进行建设。探针设备部署在客户的分支机构或下级单位等多个网络出口处，完全不需要改变用户的网络环境，避免设备影响用户网络。探针设备将监测到的流量数据和分析信息上报给管理平台进行分析。

5 产品规格
型号 APT平台 APT探针
CPU 海光7360*2 海光3250
操作系统 银河麒麟V10 统信V20
固定接口 2GE&4SFP+ 6GE&4SFP&2SFP+
USB接口 2个 2个
产品形态 硬件 硬件
内存 128G 32G
硬盘 960G SSD+32TB企业级硬盘 4TB企业级硬盘
冗余电源 是 是

声明
1. 本文档所提到的产品规格及资讯仅供参考，相关内容可能会随时更新，天融信不另行通知。
2. 本文档中提到的产品功能或性能可能因产品具体型号、配备环境和配置方法不同而有所差异，此类情况产生的差异为正常现象，产品功能或性能请以产品用户手册等资料为准。
3. 本文档中提到的信息为正常公开的信息，如因本文档或其所提到的任何信息造成或可能造成他人直接或间接的资料流失、利益损失，天融信及其员工不承担任何责任。