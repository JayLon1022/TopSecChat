CryptoShield勒索样本分析

病毒概述  
近日，天融信EDR安全团队捕获了一种病毒样本。黑客通过社工手段诱骗受害者点击下载文件。在点击文件后，病毒会复制自身到指定目录，并向后台发送生成的密钥和受害者ID。同时，它在注册表中设置开机启动项，检测磁盘，如果发现U盘，则将自身复制过去。病毒采用RSA算法进行加密，针对特定类型的文件进行加密，并在桌面上生成勒索信，清理备份文件。天融信EDR能够精确检测并清除该木马，有效阻止事件蔓延。

病毒分析  
收到样本后，使用侦壳软件打开，发现没有壳。程序运行后，尝试建立1FAAXB2.tmp文件，获取当前用户名和盘符信息，建立互斥以防重复运行。随后，创建文件夹，将自身复制并改名为smartscreen.exe，打开注册表并尝试添加开机自启动，启动项为Windows SmartScreen和Windows SmartScreen Updater。

尝试连接黑客后台45.76.81.110，并新建存放密钥的文件ExcelFavorite.acl。调用密钥算法，生成密钥，并将内容写入到密钥文件。将生成的密钥整理，并在密钥前后添加标识。第二次尝试连接黑客服务器，将密钥等信息发送。

将密钥加载，准备开始加密，再次遍历盘符。如果不是本地磁盘，则将病毒拷贝过去，命名为勒索解密工具。开始遍历文件，首先判断文件夹名，如果在名单内，则跳过不加密。之后判断文件的后缀名是否在名单内，如果在，则进行加密。加密完成后，在目录下生成两种格式的勒索信，内容一致。

加密完成后，生成1FAAXB2.tmp文件，并写入AFEE16BC，然后删除密钥文件。调用cmd清理备份文件，防止还原，最后打开勒索信，程序退出。

防护建议  
针对该病毒，可以通过以下三种方式进行防御或查杀：  
1. 下载安装天融信EDR防御软件并进行全盘扫描，以清除该木马。  
2. 更改系统及应用使用的默认密码，配置高强度密码认证，并定期更新密码。  
3. 及时修复系统及应用漏洞。  

天融信EDR获取方式  
- 天融信EDR企业版试用：可通过天融信各地分公司获取（查询网址：http://www.topsec.com.cn/contact/）  
- 天融信EDR单机版下载地址：http://edr.topsec.com.cn