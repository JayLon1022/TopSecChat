Darkside 勒索病毒样本分析

目录
一、 概述
二、 程序逆向
三、 附录

一、 概述
6月1日，从互联网获取到病毒样本，该样本为带壳程序。启动后，通过解压的方式获取配置信息，按照配置信息进行相应处理，删除回收站内的文件，在本地文件夹下释放勒索图标，获取主机信息并拼接后通过POST方式发送到黑客后台，读取主机的GUID，计算出勒索ID，并与勒索信的名字进行拼接。根据配置信息，对相应目录内的文件进行加密，完成加密后释放勒索信，并删除卷影文件。

二、 程序逆向
使用侦壳软件检测，发现使用了UPX壳。脱壳后确认程序为Delphi。进行静态分析时，为了躲避分析，程序使用了动态加载API，找到回收站路径并清理回收站文件，同时动态解密配置文件。

不加密以下文件夹、文件及后缀名的文件。

查找并杀死以下服务和进程，访问黑客后台。

勒索信内容为readme文件名。

从注册表获取当前主机的GUID，以得出勒索ID。

生成勒索ID，并将之前解密出的文件名进行拼接，得到完整的勒索信文件名。

获取当前主机信息。

伪装浏览器头，向黑客服务器发送受害者信息。

调用加密模块对文件进行加密。

附录
文中涉及样本SHA256：4d9432e8a0ceb64c34b13d550251b8d9478ca784e50105dc0d729490fb861d1a