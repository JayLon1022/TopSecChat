Eking 勒索病毒分析

目录
一、概述
二、程序逆向
三、附录

一、概述  
3月2日，从互联网获取到一个病毒样本，该样本为带宏的文档，诱使目标点击以启动宏。通过读取内容，该程序能够退出执行以躲避沙箱检测，生成文件并使用rundll32加载这些文件，以规避杀毒软件的检测。随后，它下载真正的勒索病毒，病毒文件经过加壳处理以避免沙箱的静态检测，同时删除备份文件。对于数据库等格式的文件，它使用AES算法进行加密，并设置开机自启动。在勒索完成后，生成勒索信。

二、程序逆向  
检测文档确认存在宏代码，如下图所示：  
宏代码在第8段。  

在公共文件夹中生成xls文件后进行改名，使用rundll32加载运行文件，如下图所示：  

用侦壳软件检测，判断为无壳的dll文件，如下图所示：  
加载到dll后，新建cs5文件夹，如下图所示：  
从黑客服务器下载勒索程序，带壳调试，首先调用命令行删除备份，关闭防火墙。  

生成勒索ID，将自身复制到local文件夹下，设置开机自启动。整理后如下：  
被勒索的文件后缀，获取计算机名，准备加密，生成勒索后文件的后缀名，调用AES算法开始加密。  
加密完成后，修改文件名。所有文件加密完成后，在C盘根目录释放勒索信。

三、附录  
文中涉及样本SHA256：  
667f88e8dcd4a15529ed02bb20da6ae2e5b195717eb630b20b9732c8573c4e83